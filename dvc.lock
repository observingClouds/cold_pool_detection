schema: '2.0'
stages:
  download_example_SAR:
    cmd: python src/data/download_SAR.py --start "2020-01-13T00:00:00Z" --end "2020-01-13T23:59:59Z"
    deps:
    - path: src/data/download_SAR.py
      hash: md5
      md5: 8f030f66a1ddfe9b78cfdf09f44cf2a2
      size: 1654
    outs:
    - path: data/SAR/
      hash: md5
      md5: 72bb7da7eb810766ad63f828ca33f3ff.dir
      size: 53385440
      nfiles: 4
  regrid_GOES16_ABI:
    cmd: python src/data/regrid_GOES.py -f data/GOES16/OR_ABI-L1b-RadF-M6C13_G16_s20200130940200_e20200130949519_c20200130950003.nc
      -c C13 -i data/examples/GOES16-ABI_BT_C13_20201130940.png
    deps:
    - path: data/GOES16/OR_ABI-L1b-RadF-M6C13_G16_s20200130940200_e20200130949519_c20200130950003.nc
      hash: md5
      md5: b608906791607bebb3b5a30836cdc6d3
      size: 29511412
    - path: src/data/regrid_GOES.py
      hash: md5
      md5: c26934347bfe66cb31917ffefe475696
      size: 1340
    outs:
    - path: data/examples/GOES16-ABI_BT_C13_20201130940.png
      hash: md5
      md5: a1a6db3347a3f101b05f7b658b862ca3
      size: 1232008
  regrid_SAR:
    cmd: python src/data/regrid_SAR.py -v owiWindSpeed -i data/examples/SAR_WindSpeed_20200113.png
    deps:
    - path: data/SAR/
      hash: md5
      md5: 72bb7da7eb810766ad63f828ca33f3ff.dir
      size: 53385440
      nfiles: 4
    - path: src/data/regrid_SAR.py
      hash: md5
      md5: e6c739aaf59133f54ec0724164e26271
      size: 2561
    outs:
    - path: data/examples/SAR_WindSpeed_20200113.png
      hash: md5
      md5: 1d67768628d284af064dcd62145af54f
      size: 228504
  download_SAR_GRD_Brilouet2023:
    cmd: python src/data/download_SAR_EE.py --start "2020-02-13T00:00:00Z" --end "2020-02-13T23:59:59Z"
      --product GRD_HD --output data/SAR/GRD_EE/
    deps:
    - path: src/data/download_SAR_EE.py
      hash: md5
      md5: 4cc8e2508c350a7eaf88580c129c7c31
      size: 2163
    outs:
    - path: data/SAR/GRD_EE/
      hash: md5
      md5: 0ae380fdbeb0bdda6ad51f20469bf004.dir
      size: 1176654497
      nfiles: 1
  reproduce_Brilouet2023_fig3:
    cmd: python src/gradient_detection_SAR_brilouet_etal_2023.py -i data/SAR/GRD_EE/SENTINEL-1_2020-02-13T00:00:00Z_2020-02-13T23:59:59Z_GRD_HD_DESCENDING_IW.nc
      -o data/figures/brilouet_etal_2023_fig3 --lat_start=10.1 --lat_end=9.7 --lon_start=-58
      --lon_end=-57.3
    deps:
    - path: data/SAR/GRD_EE/
      hash: md5
      md5: 0ae380fdbeb0bdda6ad51f20469bf004.dir
      size: 1176654497
      nfiles: 1
    - path: src/gradient_detection_SAR_brilouet_etal_2023.py
      hash: md5
      md5: 7ee1e20dcd095c5e3c0d06dbc31181ff
      size: 6324
    outs:
    - path: data/figures/brilouet_etal_2023_fig3
      hash: md5
      md5: 4ddea35b5ec59912827dd3a2e5084602.dir
      size: 416900
      nfiles: 3
  reproduce_Brilouet2023_fig2a:
    cmd: python src/gradient_detection_SAR_brilouet_etal_2023.py -i data/SAR/GRD_EE/SENTINEL-1_2020-02-13T00:00:00Z_2020-02-13T23:59:59Z_GRD_HD_DESCENDING_IW.nc
      -o data/figures/brilouet_etal_2023_fig2a
    deps:
    - path: data/SAR/GRD_EE/
      hash: md5
      md5: 0ae380fdbeb0bdda6ad51f20469bf004.dir
      size: 1176654497
      nfiles: 1
    - path: src/gradient_detection_SAR_brilouet_etal_2023.py
      hash: md5
      md5: 7ee1e20dcd095c5e3c0d06dbc31181ff
      size: 6324
    outs:
    - path: data/figures/brilouet_etal_2023_fig2a
      hash: md5
      md5: a311c9e0399b48b33f9c45566e987ca9.dir
      size: 138095
      nfiles: 3
  classify_tompkins_2001_example:
    cmd: python src/tompkins_et_al_2001.py --time "2020-01-10 00:00:00" --output data/examples/tompkins
    deps:
    - path: src/tompkins_et_al_2001.py
      hash: md5
      md5: 111ae7e02b6c597412f77754b499dd9a
      size: 5515
    outs:
    - path: data/examples/tompkins
      hash: md5
      md5: ed2d96a9902078a4a114c052e58c9c54.dir
      size: 777016
      nfiles: 4
  generate_ground_truth_simulation:
    cmd: python src/label/generate_ground_truth_simulation.py --output data/labels
    deps:
    - path: src/label/generate_ground_truth_simulation.py
      hash: md5
      md5: a83b0fd100e7ed6851475c752bdfa594
      size: 799
    params:
      params.yaml:
        ground_truth_simulation.method: tompkins_2001
        tompkins_2001.avg_length: 100000
        tompkins_2001.buoyancy_threshold: 0.05
    outs:
    - path: data/labels
      hash: md5
      md5: 9ae5979262de10dd2c6334f2060539d1.dir
      size: 1920767407
      nfiles: 1312
  generate_tfds:
    cmd: cd data; tar -cvzf labels.tar.gz labels; cd sim_cp_tompkins; tfds build --overwrite
      --download_config '{"download_mode":"force_redownload"}' --noforce_checksums_validation
      --register_checksums
    deps:
    - path: data/labels
      hash: md5
      md5: 9ae5979262de10dd2c6334f2060539d1.dir
      size: 1920767407
      nfiles: 1312
    outs:
    - path: data/labels.tar.gz
      hash: md5
      md5: 5ae9c3c53d8828383b7dd212e6c15ca0
      size: 1918184878
    - path: data/sim_cp_tompkins/checksums.tsv
      hash: md5
      md5: 03f5f9f30e1ff96524bde445a7160b5b
      size: 165
  train_neural_network:
    cmd: python src/train/train.py
    deps:
    - path: data/labels.tar.gz
      hash: md5
      md5: 5ae9c3c53d8828383b7dd212e6c15ca0
      size: 1918184878
    - path: models/checkpoints/checkpoint_DenseNet121
      hash: md5
      md5: 497d0c7a10e093089b261f04e8bab7a0.dir
      size: 339374803
      nfiles: 9
    - path: src/train/train.py
      hash: md5
      md5: 3083911551896df3a11543816330afeb
      size: 6970
    params:
      params.yaml:
        neural_network:
          dataset: sim_cp_tompkins:1.0.0
          batch_size: 1
          buffer_size: 1000000
          epochs: 200
          val_subsplit: 5
          output_classes: 2
    outs:
    - path: eval/labels/sample_images.png
      hash: md5
      md5: c98f8a00f972d1f1f59f982140c81a76
      size: 182370
    - path: eval/labels/sample_masks.png
      hash: md5
      md5: 9f673c051db399c641d9dff437b0f725
      size: 54832
    - path: eval/training_nn/plots/predictions/
      hash: md5
      md5: 54d864715367698c8a21823adb81320a.dir
      size: 16156324
      nfiles: 200
    - path: models/checkpoints/training_checkpoints
      hash: md5
      md5: 0d9a8dba112bb13eb2119b4a16cd80e2.dir
      size: 63350662
      nfiles: 3
  download_NN_weights:
    cmd:
    - dvc get-url --force "https://www.dropbox.com/s/idenhh7g4j3vapb/checkpoint_densenet121.zip?dl=1"
    - unzip checkpoint_densenet121.zip
    - rm checkpoint_densenet121.zip
    outs:
    - path: checkpoint_DenseNet121
      hash: md5
      md5: 497d0c7a10e093089b261f04e8bab7a0.dir
      size: 339374803
      nfiles: 9
